# タスク履歴管理ルール

## 📋 このファイルの目的

このドキュメントは、タスク履歴（`task_history/` 配下の `.md` ファイル）の生成・管理ルールを定義します。

### 対象読者

1. **AI エージェント（Claude Code など）**
   - セッション開始時にこのファイルと過去のタスク履歴を読み込み、プロジェクトの進捗状況を把握する
   - 新しいタスクを完了したら、このルールに従ってタスク履歴ファイルを生成する

2. **人間の開発者**
   - 実装時に一時的にブラックボックスが存在していても、後から実装の概要を理解できるようにする
   - セッション間の引き継ぎ事項を確認する

---

## 📝 タスク履歴の記録ルール

### 記録すべき情報

各タスク履歴ファイルには以下の情報を含める：

#### 1. タスクの概要
- **目的**: 何を達成しようとしたのか
- **背景**: なぜこのタスクが必要だったのか
- **スコープ**: どこまでを対象としたか

#### 2. 技術的決定事項
- **採用した技術・ライブラリ**: なぜそれを選んだのか
- **設計方針**: アーキテクチャやパターンの選択理由
- **データ構造**: 重要な型定義やスキーマ
- **設定**: 環境変数、設定ファイルの内容

#### 3. 遭遇した問題と解決策
- **問題**: どんな課題に直面したか
- **原因**: 根本原因は何だったか
- **解決策**: どのように解決したか
- **学び**: 次回に活かせる知見

#### 4. 実装の概要
- **主要な機能**: 実装した機能の簡潔な説明
- **ファイル構成**: 追加・変更したファイルの役割
- **テスト**: テストの方針と結果
- **動作確認**: 実行方法と結果

#### 5. 次回への引き継ぎ事項
- **未完了のタスク**: 残っている作業
- **既知の問題**: バグや改善点
- **今後の拡張案**: 将来的に実装したい機能

### 記録しない情報

- **コードの差分**: git で管理するため不要
- **詳細なコードスニペット**: 必要最小限のみ（例：重要なインターフェース定義など）
- **実装の細かい手順**: 概要レベルで十分

---

## 📁 ファイル命名規則

```
task_history/YYYY-MM-DD_task-name.md
```

### 例:
- `2025-11-30_scraping-nikkei-ranking.md`
- `2025-12-01_setup-supabase-schema.md`
- `2025-12-02_fix-listing-market-bug.md`

### ルール:
- 日付は ISO 8601 形式（`YYYY-MM-DD`）
- タスク名は小文字・ハイフン区切り
- 簡潔で内容が分かる名前を付ける

---

## 📄 タスク履歴ファイルのテンプレート

各タスク履歴ファイルは以下のテンプレートに従って作成する：

```markdown
# [タスク名]

**日付**: YYYY-MM-DD
**担当**: [開発者名 or AI Agent]
**ステータス**: ✅ 完了 / 🚧 進行中 / ⏸️ 一時停止

---

## 📌 タスクの概要

### 目的
- [何を達成しようとしたのか]

### 背景
- [なぜこのタスクが必要だったのか]

### スコープ
- [どこまでを対象としたか]

---

## 🛠️ 技術的決定事項

### 採用した技術・ライブラリ
- **[技術名]**: [選択理由]

### 設計方針
- [アーキテクチャやパターンの選択理由]

### 重要なデータ構造
```typescript
// 例: 重要なインターフェース定義
interface CompanyData {
  // ...
}
```

---

## 🐛 遭遇した問題と解決策

### 問題 1: [問題の簡潔な説明]
- **原因**: [根本原因]
- **解決策**: [どのように解決したか]
- **学び**: [次回に活かせる知見]

---

## ✅ 実装の概要

### 主要な機能
- [実装した機能のリスト]

### ファイル構成
```
プロジェクトルート/
├── src/
│   ├── [新規ファイル] - [役割]
│   └── [変更ファイル] - [変更内容]
```

### テスト
- **方針**: [TDD, 単体テストなど]
- **結果**: [X/Y テストパス]

### 動作確認
```bash
# 実行コマンド
npm run [command]
```

**結果**: [成功 / 一部失敗 / エラー詳細]

---

## 🔜 次回への引き継ぎ事項

### 未完了のタスク
- [ ] [残っている作業]

### 既知の問題
- [バグや改善点]

### 今後の拡張案
- [将来的に実装したい機能]

---

## 📚 参考リンク
- [関連ドキュメントのURL]
- [参考にした記事・ライブラリのURL]
```

---

## 🔄 タスク履歴の更新タイミング

以下のタイミングでタスク履歴を生成・更新する：

1. **大きなタスクの完了時**
   - 新機能の実装が完了した
   - バグ修正が完了した
   - 設計変更が完了した

2. **セッション終了時**
   - 作業途中でも、次回に引き継ぐ必要がある場合

3. **重要な決定をした時**
   - 技術スタックの選定
   - アーキテクチャの大幅な変更

---

## 💡 運用のコツ

### AI エージェント向け
- セッション開始時は必ず `task_history/` 配下の最新ファイルを読み込む
- タスク完了時は、ユーザーに確認してからタスク履歴を生成する
- テンプレートを厳密に守りつつ、必要に応じて項目を追加・削除する

### 人間の開発者向け
- タスク履歴は「未来の自分へのメモ」として書く
- 詳細すぎる情報は避け、**なぜそうしたか**にフォーカスする
- git のコミットメッセージと合わせて読むと理解が深まる

---

**最終更新日**: 2025-11-30
