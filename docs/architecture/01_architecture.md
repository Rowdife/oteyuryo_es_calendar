# アーキテクチャ（MVP / リポジトリ内データ保持）

対象：日本（日本語）／新卒就活生向け  
前提：少人数運用、データ更新は「時間がある時に不定期」  
スコープ：posting（募集要項）と tags をどこに保存し、どう読ませるか

---

## 1) 結論

- posting 情報と tags 情報は **当面リポジトリ内（ファイル）で保持**する。
- UI はファイルを直接参照せず、`web/lib/` の **Data Access Layer（DAL）** 経由で取得する（将来のDB移行を容易にする）。

---

## 2) なぜ DB ではなくリポジトリ内か（判断理由）

### 採用理由（MVPの優先度に合う）
- **運用が最速**：PR → デプロイの流れで更新でき、管理画面や権限設計が不要
- **障害点が少ない**：DB/認証/課金/バックアップ等の運用要素が増えない
- **コストがゼロに近い**：初期費用・ランニング・ロックインを避けられる
- **信頼性設計と相性が良い**：出典URLと「最終確認日時」をデータとして持ち、静的に提供できる

### 想定される弱点（受け入れる制約）
- 即時反映はできない（デプロイが必要）
- 編集体験はGit前提（非エンジニア運用に弱い）
- 高度な検索や大量データには不向き（ただしMVPでは問題になりにくい）

---

## 3) データモデル（最小）

### Posting（募集要項）＝主エンティティ
- `postingId`：不変ID（URLにも利用）
- `companyId`：企業ID（同社内の他posting回遊に利用）
- `companyName`
- `title`：職種／コース名
- `deadlineAt`：ES締切（日時 or 日付）※粒度を壊さない
- `sourceUrl`：公式出典URL（必須に近い扱い）
- `verifiedAt`：最終確認日時（JST表示）
- `tags`：文字列配列（例：`["メーカー","技術職"]`）

### Tags
- タグ一覧は postings から集計してもよい（MVPは重複排除+ソートで十分）
- 将来的に「表示順」「カテゴリ」などが必要になったら `tags.json` を追加する

---

## 4) 保存場所・ファイル構成（提案）

既存構造に寄せて `web/data/` を採用する。

```
services/oteyuryo_es_calendar/web/
  data/
    postings.json
    (optional) tags.json
  lib/
    data.ts
```

形式は JSON 推奨（人手で編集しやすく、型付けもしやすい）。

---

## 5) 読み込み境界（DAL: Data Access Layer）

### 原則
- UI（`app/` や `components/`）は `fs` やパスを直接扱わない。
- `web/lib/data.ts` の関数だけを呼ぶ。

### 期待する関数（例）
- `getPostings(): Posting[]`
- `getPostingById(postingId): Posting | null`
- `getCompanies(): Company[]`（必要になったら）

これにより、DB移行時は `web/lib/data.ts` の中身を差し替えるだけで済む。

---

## 6) 信頼性（Trust）を壊さないためのルール

- `sourceUrl` が無い posting は原則掲載しない（掲載する場合は「出典なし」を明示）
- `deadlineAt` の粒度は **推測で補完しない**
  - 例：日付しか分からないなら `YYYY-MM-DD（時刻未確認）` として表示
- `verifiedAt`（最終確認）を必ず表示し、古い場合はユーザーに分かるUIにする（警告表示など）

---

## 7) DB 移行のトリガ（いつ Firebase/Supabase 等を検討するか）

以下のいずれかが現実化したら、DB/管理画面を検討する。

- 通報修正を **当日反映**したい
- 更新頻度が高く、Git運用がボトルネックになる
- 編集者が増え、非エンジニアでも更新できる必要がある
- 高度な検索（全文検索、複合条件）やデータ量で性能が問題になる
- 更新履歴・監査・SLA を運用として回す必要が出る

---

## 8) 未決事項（次に決める）

- `deadlineAt` の表現（日時あり／日付のみ）をどの型で持つか
- postingId の採番ルール（例：`companyId + 年 + 連番` など、変更に強い方式）
- 公式URLの正規化（追跡パラメータ除去、アンカー扱い）

